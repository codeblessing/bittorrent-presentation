---
favicon: resources/favicon.png
titleTemplate: BitTorrent - %s
author: Jakub Kwiatkowski, Maciej Grze≈õ, Krzysztof Jaje≈õnica
fonts:
  sans: 'JetBrains Mono'
theme: default
title: Distributed file sharing protocol
background: resources/title-cover.jpg
layout: cover
hideInToc: true
mdc: true
---

# BitTorrent

## DISTRIBUTED FILE SHARING PROTOCOL

---
theme: seriph
title: Agenda
hideInToc: true
transition: slide-left
---

# Agenda

<Toc maxDepth="1"></Toc>

---
title: Overview
transition: slide-left
---

# Overview

BitTorrent is the protocol designed to load-balance download servers and make file-sharing more accessible to everyone.

It utilizes file chunking and P2P (peer-to-peer) connections to distribute load between multiple nodes.

<!-- TODO: Insert animation presenting file download with let's say 5 nodes - 1 master, 4 clients. -->

---
title: Tracker
transition: slide-left
---

# Tracker

Tracker is a server that holds information about torrent 'state'.

In order to work properly BitTorrent have to have information about parts and peers.
Holding these information is work of so called tracker.

Tracker is kind of control server for BitTorrent network.
At first it knows only about _seed_ (origin) server and have list of pieces with appropriate hashes.
When new peer wants to download file it sends `announce` message to tracker.
Tracker gather all `announce` messages and adds peers to it's database.

---
title: Peers
transition: slide-left
---

# Peers

Peer is any BitTorrent client that takes part in torrent network.

When client wants to download file it has to send `announce` message.
`announce` message contains following data:

```yaml
info_hash: <torrent_hash> 
peer_id: <client_hash>
ip: client's IP
port: port on which client is listening
uploaded: <number of parts uploaded>
downloaded: <number of parts downloaded>
left: <byte size of parts left to download>
event: one of started|completed|stopped|empty
```

Because BitTorrent uses HTTP this request is HTTP `GET` and data are passed as parameters.

```HTTP
GET /announce?info_hash=abcdef1234567890&peer_id=client_peer_id&ip=192.168.1.100&port=6881&uploaded=0&\
              downloaded=0&left=remaining_bytes&event=started HTTP/1.1
Host: tracker.example.com
```

<!-- 
1. `info_hash` is constructed as SHA-1 hash of `info` dictionary in .torrent file.
2. `peer_id` is random id generated by client itself.
3. `event` is optional and can be omitted, but it's reasonable to pass it.
-->

---
transition: slide-left
---

In response to `announce` tracker returns list of peers to connect with:
```bencode
d8:intervali3600e5:peersld2:ip13:192.168.1.1007:peer_id20:SirAlexanderHamilton4:porti6881eeee
```

Having this info client can connect directly to other peers to download files.

---
title: Seed
transition: slide-left
---

# Seed

Seed is server containing whole file that is shared.

Seed is really the basic unit of BitTorrent distributed network.
In theory, every peer will become seed when it downloads all parts.

If peer has good two-way bandwidth it can be 'partial' seed and share parts it already downloaded without downloading whole file. 

<!-- TODO: It would be nice to have some animation presenting concept here. -->

---
title: Torrent network
transition: slide-left
---

# Sharing file

Having basic building blocks we can now describe full file sharing process.

::v-click
1. At first we have to start *tracker*.
::v-click
2. Next we create metadata (*.torrent*) file.
::v-click
3. Now we start our first *seed* (file origin) and send `announce` to the tracker.
::v-click
4. Peer wants to download file, so it sends `announce` message to the tracker and retrieves list of other peers (including *seed*).
::v-click
5. Downloading peer connects directly to seeding peers.
::v-click
6. After part has been downloaded it is integrity-checked on downloading peer.
::v-click
7. When all parts have been downloaded downloading peer sends announce to tracker and becomes seed.


<!--
1. Let's say our tracker will be listening on address `https://example.com/torrent/announce`
2. '.torrent' files will be described shortly.
3. Now everything is set up and we can start downloading files.
4. Every peer has to 'self-assign' to tracker in order to retrieve peer list but it doesn't mean it shares anything at once.
6. Integrity check is mandatory and client should never inform tracker it downloaded part without checking it's integrity first.
7. This part is not mandatory but peers that only download (leechers) are totally worthless (even harmful) for network.
-->


---
theme: seriph
layout: cover
class: text-center
transition: slide-left
title: .torrent
---

# .torrent

---
theme: seriph
class: text-center
highlighter: shiki
lineNumbers: false
transition: slide-left
mdc: true
---

`.torrent` file defines metadata of shared file. It contains information about tracker and file itself.

```yaml
announce: "https://example.com/torrent/announce",
info: 
  name: "srds-exam-answers.pdf",
  piece length: 262144,
  pieces: √®v√∂z*ÀÜ‚Ä†√®√≥kg&√É¬¢‚Äî-n"u√¶¬†vfVsn¬Å√ø¬µR¬≠,
  length: 26214400
```

